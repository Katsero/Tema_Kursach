<!-- music/templates/home.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ –ê–Ω–æ–Ω–∏–º–Ω–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f9f9f9;
            color: #333;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .search-container input,
        .search-container select,
        .search-container button {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .track-list {
            display: grid;
            gap: 15px;
        }
        .track-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .track-meta {
            margin: 10px 0;
            font-size: 0.9em;
            color: #555;
        }
        .track-actions {
            margin-top: 10px;
        }
        .track-actions a {
            margin-right: 15px;
            text-decoration: none;
            color: #007bff;
        }
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination a, .pagination span {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px solid #ddd;
            text-decoration: none;
            color: #007bff;
        }
        .pagination .current {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <header>
        <h1>üéµ –ê–Ω–æ–Ω–∏–º–Ω–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
        <a href="{% url 'upload' %}" style="padding: 8px 16px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–∫</a>
    </header>

    <div class="search-container">
        <form method="get">
            <input type="text" name="search" value="{{ search_query }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∂–∞–Ω—Ä—É, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é...">
            <select name="genre">
                <option value="">–õ—é–±–æ–π –∂–∞–Ω—Ä</option>
                {% for genre in all_genres %}
                    <option value="{{ genre }}" {% if genre == genre_filter %}selected{% endif %}>{{ genre }}</option>
                {% endfor %}
            </select>
            <select name="artist">
                <option value="">–õ—é–±–æ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</option>
                {% for artist in all_artists %}
                    <option value="{{ artist.name }}" {% if artist.name == artist_filter %}selected{% endif %}>{{ artist.name }}</option>
                {% endfor %}
            </select>
            <button type="submit">üîç –ù–∞–π—Ç–∏</button>
        </form>
    </div>

    {% if page_obj %}
        <div class="track-list">
            {% for track in page_obj %}
                <div class="track-card">
                    <h3>{{ track.title }}</h3>
                    <div class="track-meta">
                        <p><strong>–ó–∞–≥—Ä—É–∑–∏–ª:</strong> {{ track.uploaded_by }}</p>
                        <p><strong>–ê–ª—å–±–æ–º:</strong> {% if track.album %}{{ track.album.title }}{% else %}–ù–µ —É–∫–∞–∑–∞–Ω{% endif %}</p>
                        <p><strong>–ñ–∞–Ω—Ä:</strong> {{ track.genre|default:"–ë–µ–∑ –∂–∞–Ω—Ä–∞" }}</p>
                        <p><strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏:</strong>
                            {% for artist in track.artists.all %}
                                {{ artist.name }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                                –ù–µ —É–∫–∞–∑–∞–Ω—ã
                            {% endfor %}
                        </p>
                    </div>
                    <div class="track-actions">
                        <audio controls style="width: 100%;">
                            <source src="{{ track.audio_file.url }}" type="audio/mpeg">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
                        </audio>
                        <br>
                        <a href="{{ track.audio_file.url }}" download>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å</a>
                    </div>
                </div>
            {% empty %}
                <p>–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤ –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.</p>
            {% endfor %}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}{% if artist_filter %}&artist={{ artist_filter }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}{% if artist_filter %}&artist={{ artist_filter }}{% endif %}">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}

            <span class="current">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}{% if artist_filter %}&artist={{ artist_filter }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}{% if artist_filter %}&artist={{ artist_filter }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
            {% endif %}
        </div>
    {% else %}
        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤.</p>
    {% endif %}
</body>
</html>